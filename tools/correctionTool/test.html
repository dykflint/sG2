<!DOCTYPE html>
<html>
<head>
  <title>Dynamic Input Fields</title>
  <style>
    input {
      width: 300px;
      padding: 5px;
      margin-bottom: 10px;
    }

    .input-field {
      display: flex;
    }

    .line-number {
      display: inline-block;
      width: 20px;
      text-align: center;
      margin-right: 5px;
    }

    #inputFieldsContainer {
      display: flex;
      flex-direction: column;
    }
  </style>
</head>
<body>
  <div id="wordCountRow">Total Words: 0</div>
  <div id="inputFieldsContainer">
    <div class="input-field">
      <span class="line-number">1</span>
      <input type="text" onkeydown="handleKeyDown(event)" data-line="1">
    </div>
  </div>

  <script>
  let totalWords = 0;
  function handleKeyDown(event) {
    const currentInput = event.target;
    if (event.key === 'Enter') {
      event.preventDefault();
      createInputFieldAfter(currentInput);
    } else if (event.key === 'ArrowDown') {
      event.preventDefault();
      focusNextInputField(currentInput);
    } else if (event.key === 'ArrowUp') {
      event.preventDefault();
      focusPreviousInputField(currentInput);
    } else if (event.key === 'Backspace') {
      handleBackspaceKey(currentInput);
    }
  }

    function createInputFieldAfter(currentInput) {
      const inputField = document.createElement('div');
      inputField.className = 'input-field';

      const input = document.createElement('input');
      input.type = 'text';
      input.onkeydown = handleKeyDown;

      const lineNumber = parseInt(currentInput.dataset.line) + 1;
      input.dataset.line = lineNumber;

      const lineNumberElement = document.createElement('span');
      lineNumberElement.className = 'line-number';
      lineNumberElement.textContent = lineNumber;

      inputField.appendChild(lineNumberElement);
      inputField.appendChild(input);

      const container = document.getElementById('inputFieldsContainer');
      container.insertBefore(inputField, currentInput.parentElement.nextSibling);
      input.focus();

      // Update line numbers of all input fields
      updateLineNumbers();
      
      // Add input event listener to the newly created input field
      input.addEventListener('input', handleInput);
    }

    function updateLineNumbers() {
      const container = document.getElementById('inputFieldsContainer');
      const inputFields = container.querySelectorAll('.input-field');
      let lineNumber = 1;

      inputFields.forEach((inputField) => {
        const input = inputField.querySelector('input');
        const lineNumberElement = inputField.querySelector('.line-number');
        lineNumberElement.textContent = lineNumber;
        input.dataset.line = lineNumber;
        lineNumber++;
      });
    }

    function focusNextInputField(currentInput) {
      const container = document.getElementById('inputFieldsContainer');
      const inputFields = container.querySelectorAll('.input-field');
      const currentIndex = Array.from(inputFields).indexOf(currentInput.parentElement);
      const nextIndex = (currentIndex + 1) % inputFields.length;

      if (nextIndex !== 0 || currentIndex !== inputFields.length - 1) {
        inputFields[nextIndex].querySelector('input').focus();
      }
    }

    function focusPreviousInputField(currentInput) {
      const container = document.getElementById('inputFieldsContainer');
      const inputFields = container.querySelectorAll('.input-field');
      const currentIndex = Array.from(inputFields).indexOf(currentInput.parentElement);
      const previousIndex = (currentIndex - 1 + inputFields.length) % inputFields.length;

      if (previousIndex !== inputFields.length - 1 || currentIndex !== 0) {
        inputFields[previousIndex].querySelector('input').focus();
      }
    }

    function handleBackspaceKey(currentInput) {
    if (currentInput.selectionStart === 0 && currentInput.selectionEnd === 0) {
      const previousInput = getPreviousInput(currentInput);
      if (previousInput) {
        event.preventDefault();
        const textToMove = currentInput.value;
        const previousInputValue = previousInput.value;
        const previousInputCursorPosition = previousInput.value.length;

        currentInput.value = '';

        if (previousInputValue !== '' || textToMove !== '') {
          previousInput.value = previousInputValue + textToMove;

          // Move cursor to the end of the previous input field
          previousInput.setSelectionRange(previousInputCursorPosition, previousInputCursorPosition);
        } else {
          removeInputField(currentInput);
        }

        previousInput.focus();

        // Update line numbers of all input fields
        updateLineNumbers();
      }
    }
  }
  function handleInput(event) {
    const currentInput = event.target;
    const textToMove = currentInput.value;
    const previousInput = getPreviousInput(currentInput);
    
    if (currentInput.selectionStart === 0 && currentInput.selectionEnd === 0) {
      if (previousInput && (previousInput.value !== '' || textToMove !== '')) {
        event.preventDefault();
        const previousInputValue = previousInput.value;
        const previousInputCursorPosition = previousInput.value.length;

        previousInput.value = previousInputValue + textToMove;
        currentInput.value = '';

        // Move cursor to the end of the previous input field
        previousInput.setSelectionRange(previousInputCursorPosition, previousInputCursorPosition);
        previousInput.focus();
      } else if (!previousInput && textToMove === '') {
        removeInputField(currentInput);
        // Update line numbers of all input fields
        updateLineNumbers();
      }
    }
    updateWordCount();
  }

  function removeInputField(inputFieldToRemove) {
    const container = document.getElementById('inputFieldsContainer');
    container.removeChild(inputFieldToRemove.parentElement);
  }

  function getPreviousInput(currentInput) {
    const container = document.getElementById('inputFieldsContainer');
    const inputFields = container.querySelectorAll('.input-field');

    for (let i = 0; i < inputFields.length; i++) {
      if (inputFields[i].querySelector('input') === currentInput) {
        const previousInput = inputFields[i - 1]?.querySelector('input');
        if (previousInput && currentInput.value === '') {
          removeInputField(currentInput);
        }
        return previousInput;
      }
    }
    return null;
  }

  function updateWordCount() {
      const inputFields = document.querySelectorAll('input');

      totalWords = 0;
      inputFields.forEach((input) => {
        totalWords += input.value.trim().split(/\s+/).length;
        console.log("total words = " + totalWords);
      });

      const wordCountRow = document.getElementById('wordCountRow');
      wordCountRow.textContent = `Total Words: ${totalWords}`;
    }
    // Add input event listener to each input field
    const inputFields = document.querySelectorAll('input');
    inputFields.forEach((input) => {
      input.addEventListener('input', handleInput);
    });
    // Update the word count initially
    updateWordCount();
  </script>
</body>
</html>
